"use strict";function sendMessage(e){$inputMessage=$("#"+e);var n=$("#chat-"+e).find(".chat-messages"),t=$inputMessage.val();if((t=cleanInput(t))&&connected){$inputMessage.val("");var s=""+new Date;console.log("1200"),socket.emit("chat message",{roomID:e,msg:t,timestamp:s});var o='<div class="message message-sender"><div class="message-text">'+t+"</div></div>";n.append(o),n[0].scrollTop=n[0].scrollHeight}}function isTyping(e){var n=e.target.id;13!==e.which&&void 0!==e.which?!1===typing&&$("#"+n).is(":focus")?(typing=!0,socket.emit("typing",{isTyping:!0,roomID:n,person:username})):(clearTimeout(timeout),timeout=setTimeout(function(){timeoutFunction(n)},2e3)):(sendMessage(n),clearTimeout(timeout),timeoutFunction(n))}function timeoutFunction(e){typing=!1,socket.emit("typing",{isTyping:!1,roomID:e,person:username})}function adminListListener(e){$("#"+e).on("click",function(e){var n=e.target.id;socket.emit("poke admin",n)})}function getChatArea(e){return"<div class='chatArea'><div class='chatHeader'></div><ul class='messages'></ul><div class='typing'></div><input class='inputMessage' id='"+e+"'' placeholder='Type here...'/></div>"}function setUsername(e){password="password",(username=(username=e).toLowerCase())&&socket.emit("login",{admin:username,password:password})}function notifyAdmin(e,n){"granted"!==Notification.permission?Notification.requestPermission():new Notification(e,{icon:"",body:n}).onclick=function(){$window.focus(),this.cancel()}}function cleanInput(e){return $("<div/>").text(e).text()}function newChatContainer(e,n,t,s){var o="";return o+='<div class="chat-container hidden" id="chat-'+e+'"><div class="main-chat-header '+colorClasses[s%colorClasses.length]+'"><button type="button" class="close" aria-hidden="true" onclick="removeChat(\''+e+"')\">Ã—</button><div>"+n+"</div><div><small>"+t+'</small></div></div><div class="chat-messages"></div><div class="chat-input"><div class="row"><div class="col-xs-9 form-group"><input type="text" class="form-control" id="'+e+'" placeholder="Type Message"></div><div class="col-xs-3 form-group"><button type="button" class="btn btn-primary form-control" onclick="sendMessage(\''+e+"')\">Send</button></div></div></div></div>"}function newSidebarChat(e,n,t,s){var o="";return o+='<div class="sidebar-chat '+colorClasses[s%colorClasses.length]+'" id="sidebar-chat-'+e+'" onclick="showChat(\''+e+"')\"><div>"+n+"</div><div><small>"+t+'</small></div><span class="sidebar-chat-notification">0</span></div>'}function addNewClient(e){var n=totalChats++;$(".chat-area").append(newChatContainer(e.roomID,e.details[0],e.details[3],n)),$("#sidebar").append(newSidebarChat(e.roomID,e.details[0],e.details[3],n));var t,s=$("#chat-"+e.roomID).find(".chat-messages"),o=$("#chat-"+e.roomID).find(".chat-messages"),i=e.history.length;if(i>0){$("#chat-"+e.roomID).find(".chat-messages").append(newTimestamp("History"));for(var a=i-1;a>=0;a--)t=!!e.history[a].who,s.append(createMessage(e.history[a].what,null,e.history[a].when,t))}$("#chat-"+e.roomID).find(".chat-messages").append(newTimestamp("Chat Start")),o[0].scrollTop=o[0].scrollHeight,($inputMessage=$("#"+e.roomID)).on("keypress",function(e){isTyping(e)});var c=e.MsgHistoryLen;s.on("scroll",function(){0===s.scrollTop()&&(socket.emit("more messages",{roomID:e.roomID,MsgHistoryLen:c}),c+=10)}),$newChatConn.play()}function showChat(e){$(".chat-container").addClass("hidden"),$("#chat-"+e).removeClass("hidden"),$("#sidebar-chat-"+e).find(".sidebar-chat-notification").text(0)}function createMessage(e,n,t,s){return e='<div class="message '+(s?"message-sender":"message-receiver")+'"><div class="message-text">'+e+"</div></div>"}function newTimestamp(e){var n="",t=new Date,s=t.getHours(),o=t.getMinutes();return s<10&&(s="0"+s),o<10&&(o="0"+o),n+='<div class="time-message"><div class="mid-horizontal-line"></div><div class="time-text"><div>'+e+"</div><div>"+(s+":"+o)+"</div></div></div>"}function newCloseChatButton(e){return'<div class="close-chat"><button class="btn btn-primary" onclick="removeChat(\''+e+"')\">Close Chat</button></div>"}function addNotification(e){var n=$("#sidebar-chat-"+e).find(".sidebar-chat-notification");n.text(parseInt(n.text())+1)}function removeChat(e){console.log("1500");var n=$("#chat-"+e),t=$("#sidebar-chat-"+e),s=$(".chat-area").find(".chat-container").first();s.length>0&&s.removeClass("hidden"),n.remove(),t.remove(),socket.emit("leave",{roomID:e})}function acceptNewClient(){socket.emit("accept client")}var $window=$(window),$newUser=$("#windowSound")[0],$newChat=$("#chatSound")[0],$newChatConn=$("#newConnectionSound")[0],$pokeAdmin=$("#pokeSound")[0],$usernameInput=$(".usernameInput"),$passwordInput=$(".passwordInput"),$loginPage=$(".login.page"),$errorPage=$(".error.page"),$chatPage=$(".chat.page"),$userList=$(".adminList"),$inputMessage,$messages,$acceptClient=$(".accept-client"),$noClientQ=$("#no-clients-q"),username,password,company,authenticated=!1,connected=!1,typing=!1,timeout=void 0,socket=io({transports:["websocket"]}),clientsWaiting=0;$newUser.loop=!0,$usernameInput.focus(),Notification.requestPermission();var totalChats=1,colorClasses=["paletton-blue","paletton-purple","paletton-green","paletton-orange"],disconnectTimers=[];console.log("from admin js",_admin),setUsername(username=_admin.username),socket.on("login",function(e){$userList.empty(),(authenticated=e.login)?($loginPage.fadeOut(),$chatPage.show(),console.log("100"),socket.emit("add admin",{admin:username,isAdmin:!0}),$userList.append("<li id="+username+">"+username+"</li>"),connected=!0,clientsWaiting=parseInt(e.clientsInQueue),clock.setCounter(clientsWaiting)):(alert(e.err),$errorPage.show(),$usernameInput.val(""),$passwordInput.val(""),username=null,$usernameInput.focus())}),$acceptClient.click(function(){acceptNewClient()}),socket.on("chat message",function(e){console.log("200"),$inputMessage=$("#"+e.roomID);var n=$("#chat-"+e.roomID),t=n.find(".chat-messages"),s=createMessage(e.msg,null,null,e.isAdmin);console.log(e),n.hasClass("hidden")&&addNotification(e.roomID),t.append(s),t[0].scrollTop=t[0].scrollHeight,$newChat.play()}),socket.on("admin added",function(e){console.log("300",e),adminListListener(e)}),socket.on("admin removed",function(e){console.log("500"),$("#"+e).remove()}),socket.on("New Client",function(e){console.log("400"),($inputMessage=$("#"+e.roomID)).length<1?addNewClient(e):($("#chat-"+e.roomID).find(".chat-messages").append(newTimestamp("Resuming Previous Chat")),clearTimeout(disconnectTimers[e.roomID])),$("#chat-"+e.roomID).hasClass("hidden")&&addNotification(e.roomID);var n=parseInt(e.clientsInQueue);clock.setCounter(n)}),socket.on("typing",function(e){console.log("600");var n=$("#chat-"+e.roomID).find(".chat-messages");e.isTyping?n.append("<small class='typing'>"+e.person+" is typing...<small>"):n.find($(".typing")).remove()}),socket.on("client ack",function(){console.log("700"),$newUser.pause()}),socket.on("User Disconnected",function(e){console.log("800"),$newUser.pause(),$inputMessage=$("#"+e);var n=$("#chat-"+e).find(".chat-messages");n.append(newTimestamp("Client Connection Lost")),n[0].scrollTop=n[0].scrollHeight}),socket.on("User Terminated",function(e){console.log("850"),$newUser.pause(),$inputMessage=$("#"+e);var n=$("#chat-"+e).find(".chat-messages");n.append(newTimestamp("Client Session Terminated")),disconnectTimers=setTimeout(function(){$("#chat-"+e).find(".chat-messages").append(newCloseChatButton(e))},3e5),n[0].scrollTop=n[0].scrollHeight}),socket.on("User Reconnected",function(e){console.log("880"),$("#chat-"+e).find(".chat-messages").append(newTimestamp("Client Reconnected")),clearTimeout(disconnectTimers[e])}),socket.on("poke admin",function(){$pokeAdmin.play()}),socket.on("reconnect",function(){console.log("900"),console.log("Reconnected!"),$userList.empty(),$(".container").empty(),$errorPage.fadeOut(),$userList.append("<li id="+username+">"+username+"</li>"),authenticated&&socket.emit("add admin",{admin:username,isAdmin:!0})}),socket.on("disconnect",function(){console.log("1000"),console.log("Disconnected!"),$errorPage.show()}),socket.on("reconnect_failed",function(){console.log("1100"),console.log("Reconnection Failed!"),$errorPage.children(".title").text("Reconection Failed. Please refresh your page. "),$window.alert("Disconnected from chat.")}),socket.on("more chat history",function(e){console.log("1300"),console.log(e);for(var n=$("#chat-"+e.roomID).find(".chat-messages"),t=e.history.length,s=0;s<t;s++)n.prepend(createMessage(e.history[s].what,null,e.history[s].when,e.history[s].who))}),socket.on("queue update",function(e){console.log("2000"),console.log("queue update",e),clientsWaiting=parseInt(e.clientsInQueue),clock.setCounter(clientsWaiting)});var clock=$(".counter").FlipClock(clientsWaiting,{clockFace:"Counter"});