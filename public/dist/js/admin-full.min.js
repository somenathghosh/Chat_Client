function sendMessage(e){var n=($inputMessage=$("#"+e)).parent().children(".messages"),s=$inputMessage.val();if((s=cleanInput(s))&&connected){$inputMessage.val("");var o=""+new Date;console.log("1200"),socket.emit("chat message",{roomID:e,msg:s,timestamp:o});var t=$('<span class="username"/>').text("You"),i=$('<span class="messageBody">').text(s),a=$('<span class="timestamp">').text(o.toLocaleString().substr(15,6)),c=$('<li class="message"/>').append(t,i,a);n.append(c),n[0].scrollTop=n[0].scrollHeight}}function isTyping(e){var n=e.target.id;13!==e.which&&void 0!==e.which?!1===typing&&$("#"+n).is(":focus")?(typing=!0,socket.emit("typing",{isTyping:!0,roomID:n,person:username})):(clearTimeout(timeout),timeout=setTimeout(function(){timeoutFunction(n)},2e3)):(sendMessage(n),clearTimeout(timeout),timeoutFunction(n))}function timeoutFunction(e){typing=!1,socket.emit("typing",{isTyping:!1,roomID:e,person:username})}function adminListListener(e){$("#"+e).on("click",function(e){var n=e.target.id;socket.emit("poke admin",n)})}function getChatArea(e){return"<div class='chatArea'><div class='chatHeader'></div><ul class='messages'></ul><div class='typing'></div><input class='inputMessage' id='"+e+"'' placeholder='Type here...'/></div>"}function setUsername(e){username=e,password="password",(username=username.toLowerCase())&&socket.emit("login",{admin:username,password:password})}function notifyAdmin(e,n){"granted"!==Notification.permission?Notification.requestPermission():new Notification(e,{icon:"",body:n}).onclick=function(){$window.focus(),this.cancel()}}function cleanInput(e){return $("<div/>").text(e).text()}var $window=$(window),$newUser=$("#windowSound")[0],$newChat=$("#chatSound")[0],$pokeAdmin=$("#pokeSound")[0],$usernameInput=$(".usernameInput"),$passwordInput=$(".passwordInput"),$loginPage=$(".login.page"),$errorPage=$(".error.page"),$chatPage=$(".chat.page"),$userList=$(".adminList"),$inputMessage,$messages,username,authenticated=!1,connected=!1,typing=!1,timeout=void 0,socket=io({transports:["websocket"]});$newUser.loop=!0,$usernameInput.focus(),Notification.requestPermission(),console.log("from admin js",_admin),setUsername(username=_admin.username),socket.on("login",function(e){$userList.empty(),(authenticated=e.login)?($loginPage.fadeOut(),$chatPage.show(),console.log("100"),socket.emit("add admin",{admin:username,isAdmin:!0}),$userList.append("<li id="+username+">"+username+"</li>"),connected=!0):(alert(e.err),$usernameInput.val(""),$passwordInput.val(""),username=null,$usernameInput.focus())}),socket.on("chat message",function(e){console.log("200");var n=($inputMessage=$("#"+e.roomID)).parent().children(".messages");if(e.isAdmin)s=$('<span class="username"/>').text("CronJ");else var s=$('<span class="username"/>').text("Client");var o=$('<span class="messageBody">').text(e.msg),t=$('<span class="timestamp">').text(e.timestamp.toLocaleString().substr(15,6)),i=$('<li class="message"/>').append(s,o,t);n.append(i),n[0].scrollTop=n[0].scrollHeight,$newChat.play()}),socket.on("admin added",function(e){console.log("300"),$userList.append("<li id="+e+">"+e+"</li>"),adminListListener(e)}),socket.on("admin removed",function(e){console.log("500"),$("#"+e).remove()}),socket.on("New Client",function(e){console.log("400"),$(".chat-area").append(newChatContainer(e.roomID)),($inputMessage=$("#"+e.roomID)).on("keypress",function(e){isTyping(e)})}),socket.on("typing",function(e){console.log("600");var n=($inputMessage=$("#"+e.roomID)).parent().children(".typing");e.isTyping?n.append("<small>"+e.person+" is typing...<small>"):n.text("")}),socket.on("client ack",function(){console.log("700"),$newUser.pause()}),socket.on("User Disconnected",function(e){console.log("800"),$newUser.pause(),($inputMessage=$("#"+e)).off(),$inputMessage.parent().remove()}),socket.on("poke admin",function(){$pokeAdmin.play()}),socket.on("reconnect",function(){console.log("900"),console.log("Reconnected!"),$userList.empty(),$(".container").empty(),$errorPage.fadeOut(),$userList.append("<li id="+username+">"+username+"</li>"),authenticated&&socket.emit("add admin",{admin:username,isAdmin:!0})}),socket.on("disconnect",function(){console.log("1000"),console.log("Disconnected!"),$errorPage.show()}),socket.on("reconnect_failed",function(){console.log("1100"),console.log("Reconnection Failed!"),$errorPage.children(".title").text("Reconection Failed. Please refresh your page. "),$window.alert("Disconnected from chat.")});