"use strict";function timeoutFunction(){typing=!1,socket.emit("typing",{isTyping:!1,roomID:id,person:"Client"})}function sendMessage(){var e=$inputMessage.val();if(e=cleanInput(e)){$inputMessage.val("");var s=""+new Date;console.log("1400"),socket.emit("chat message",{roomID:"null",msg:e,timestamp:s});$('<div class="msg_b">'+e+'<span class="timestamp">'+s.toLocaleString().substr(15,6)+"</span></div>").insertBefore($newMsg);$messages[0].scrollTop=$messages[0].scrollHeight}}function addMessages(e,s){var o;o=e.who?"msg_a":"msg_b";var t=$('<div class="'+o+'">'+e.what+'<span class="timestamp">'+e.when.toLocaleString().substr(15,6)+"</span></div>");s?(t.insertAfter($oldMsg),$messages[0].scrollTop+=t.outerHeight()):(t.insertBefore($newMsg),$messages[0].scrollTop=$messages[0].scrollHeight)}function cleanInput(e){return $("<div/>").text(e).text()}var $newChat=$("#chatSound")[0],$messages=$(".messages"),$inputMessage=$(".inputMessage"),$form=$(".formArea"),$widgetBox=$(".contentArea"),$chatBox=$(".chatArea"),$Typing=$(".typing"),$newMsg=$(".msg_push_new"),$oldMsg=$(".msg_push_old"),$submitBtn=$(".submitBtn"),socket=io({transports:["websocket"]}),typing=!1,timeout=void 0,active;console.log("removing roomID from localstore"),localStorage.removeItem("roomID"),console.log("setting roomID to localstore"),localStorage.setItem("roomID",_client.uuid);var id=localStorage.getItem("roomID");console.log("roomID from localstore",id),sessionStorage.removeItem("active"),active&&id&&($form.hide(),$chatBox.show(),console.log("100"),socket.emit("add user",{isNewUser:!1,roomID:id}),$widgetBox.show()),$(".msg_head").click(function(){console.log("200"),$widgetBox.slideToggle("slow"),null==id||active||(socket.emit("add user",{isNewUser:!0,roomID:id,Name:_client.firstName+" "+_client.lastName,Email:_client.email,Phone:_client.phone,Company:_client.company}),console.log("new user"),$form.hide(),$chatBox.show(),$inputMessage.focus(),sessionStorage.setItem("active",!0),active=!0)}),$submitBtn.click(function(){return console.log("300"),console.log("submit"),$form.hide(),$chatBox.show(),$inputMessage.focus(),sessionStorage.setItem("active",!0),console.log("brand new user"),socket.emit("add user",{isNewUser:!0,Name:_client.firstName+" "+_client.lastName,Email:_client.email,Phone:_client.phone,Company:_client.company,roomID:_client.uuid}),!1}),$inputMessage.keypress(function(e){13!==e.which?!1===typing&&$inputMessage.is(":focus")?(typing=!0,console.log("400"),socket.emit("typing",{isTyping:!0,roomID:id,person:"Client"})):(clearTimeout(timeout),timeout=setTimeout(timeoutFunction,2e3)):(sendMessage(),clearTimeout(timeout),timeoutFunction())}),$messages.on("scroll",function(){0===$messages.scrollTop()&&socket.emit("more messages",{})}),socket.on("chat message",function(e){console.log("600");var s;s=e.isAdmin?"msg_a":"msg_b";$('<div class="'+s+'">'+e.msg+'<span class="timestamp">'+e.timestamp.toLocaleString().substr(15,6)+"</span></div>").insertBefore($newMsg);$messages[0].scrollTop=$messages[0].scrollHeight,$newChat.play()}),socket.on("typing",function(e){console.log("700"),e.isTyping&&"Client"!=e.person?$Typing.append("Admin is typing..."):$Typing.text("")}),socket.on("chat history",function(e){console.log("800");for(var s=e.history.length-1;s>=0;s--)addMessages(e.history[s],!1)}),socket.on("more chat history",function(e){console.log("900");for(var s=e.history.length,o=0;o<s;o++)addMessages(e.history[o],!0)}),socket.on("log message",function(e){console.log("1000");var s=""+new Date;$('<div class="msg_a">'+e+'<span class="timestamp">'+s.toLocaleString().substr(15,6)+"</span></div>").insertBefore($newMsg);$messages[0].scrollTop=$messages[0].scrollHeight}),socket.on("disconnect",function(){console.log("1100"),localStorage.removeItem("roomID"),sessionStorage.removeItem("active"),console.log("Disconnected!"),$inputMessage.prop("disabled",!0),$inputMessage.prop("placeholder","Connection Lost! Reconnecting..")}),socket.on("reconnect_failed",function(){console.log("1200"),console.log("Reconnection Failed!"),$inputMessage.prop("placeholder","No active connection. Please refresh page.")}),socket.on("reconnect",function(){console.log("1300"),setTimeout(function(){console.log("Reconnected!"),$inputMessage.prop("disabled",!1),$inputMessage.prop("placeholder","Type here..."),active&&id&&socket.emit("add user",{isNewUser:!1,roomID:id})},4e3)}),socket.on("admin disconnected",function(){console.log("1600"),$Typing.append("Admin disconnected. Session ended.")});try{$("#client-dropzone").dropzone({url:"/upload",addRemoveLinks:!0,maxFilesize:1,maxFilesize:5,paramName:"file",dictDefaultMessage:'<span class="text-center"><span class="font-lg visible-xs-block visible-sm-block visible-lg-block"><span class="font-lg"><i class="fa fa-caret-right text-danger"></i> Drop files <span class="font-xs">to upload</span></span><span>&nbsp&nbsp<h4 class="display-inline"> (Or Click)</h4></span>',dictResponseError:"Error uploading file!",headers:{"X-CSRF-Token":$('input[name="_csrf"]').val()},acceptedFiles:"image/*",success:function(e,s){var o=""+new Date;socket.emit("upload",{filename:s.filename,roomID:"null",timestamp:o}),console.log("2100");$('<div class="msg_b">'+s.filename+'<span class="timestamp">'+o.toLocaleString().substr(15,6)+"</span></div>").insertBefore($newMsg);$messages[0].scrollTop=$messages[0].scrollHeight}})}catch(e){console.log("Error loading dropzone"),console.log(e)}