function timeoutFunction(){typing=!1,socket.emit("typing",{isTyping:!1,roomID:id,person:"Client"})}function sendMessage(){var e=$inputMessage.val();if(e=cleanInput(e)){$inputMessage.val("");var s=""+new Date;console.log("1400"),socket.emit("chat message",{roomID:"null",msg:e,timestamp:s});$('<div class="msg_b">'+e+'<span class="timestamp">'+s.toLocaleString().substr(15,6)+"</span></div>").insertBefore($newMsg);$messages[0].scrollTop=$messages[0].scrollHeight}}function addMessages(e,s){var o;o=e.who?"msg_a":"msg_b";var t=$('<div class="'+o+'">'+e.what+'<span class="timestamp">'+e.when.toLocaleString().substr(15,6)+"</span></div>");s?(t.insertAfter($oldMsg),$messages[0].scrollTop+=t.outerHeight()):(t.insertBefore($newMsg),$messages[0].scrollTop=$messages[0].scrollHeight)}function cleanInput(e){return $("<div/>").text(e).text()}var $window=$(window),$messages=$(".messages"),$inputMessage=$(".inputMessage"),$nameInput=$(".nameInput"),$phoneInput=$(".phoneInput"),$emailInput=$(".emailInput"),$form=$(".formArea"),$widgetBox=$(".contentArea"),$Input=$(".inputFields"),$chatBox=$(".chatArea"),$Typing=$(".typing"),$newMsg=$(".msg_push_new"),$oldMsg=$(".msg_push_old"),socket=io("/",{transports:["websocket"]}),typing=!1,timeout=void 0,id=localStorage.getItem("roomID"),active=sessionStorage.getItem("active");active&&id&&($form.hide(),$chatBox.show(),console.log("100"),socket.emit("add user",{isNewUser:!1,roomID:id}),$widgetBox.show()),$(".msg_head").click(function(){console.log("200"),$widgetBox.slideToggle("slow"),null==id||active||(socket.emit("add user",{isNewUser:!1,roomID:id}),console.log("new user"),$form.hide(),$chatBox.show(),$inputMessage.focus(),sessionStorage.setItem("active",!0),active=!0)}),$Input.submit(function(){return console.log("300"),console.log("submit"),$form.hide(),$chatBox.show(),$inputMessage.focus(),sessionStorage.setItem("active",!0),console.log("new user"),socket.emit("add user",{isNewUser:!0,Name:$nameInput.val().trim(),Email:$emailInput.val().trim(),Phone:$phoneInput.val().trim()}),!1}),$inputMessage.keypress(function(e){13!==e.which?!1===typing&&$inputMessage.is(":focus")?(typing=!0,console.log("400"),socket.emit("typing",{isTyping:!0,roomID:id,person:"Client"})):(clearTimeout(timeout),timeout=setTimeout(timeoutFunction,2e3)):(sendMessage(),clearTimeout(timeout),timeoutFunction())}),$messages.on("scroll",function(){0==$messages.scrollTop()&&socket.emit("more messages",{})}),socket.on("roomID",function(e){console.log("500"),id=e,localStorage.setItem("roomID",e)}),socket.on("chat message",function(e){console.log("600");var s;s=e.isAdmin?"msg_a":"msg_b";$('<div class="'+s+'">'+e.msg+'<span class="timestamp">'+e.timestamp.toLocaleString().substr(15,6)+"</span></div>").insertBefore($newMsg);$messages[0].scrollTop=$messages[0].scrollHeight}),socket.on("typing",function(e){console.log("700"),e.isTyping&&"Client"!=e.person?$Typing.append("Admin is typing..."):$Typing.text("")}),socket.on("chat history",function(e){console.log("800");for(var s=e.history.length-1;s>=0;s--)addMessages(e.history[s],!1)}),socket.on("more chat history",function(e){console.log("900");for(var s=e.history.length,o=0;o<s;o++)addMessages(e.history[o],!0)}),socket.on("log message",function(e){console.log("1000");var s=""+new Date;$('<div class="msg_a">'+e+'<span class="timestamp">'+s.toLocaleString().substr(15,6)+"</span></div>").insertBefore($newMsg);$messages[0].scrollTop=$messages[0].scrollHeight}),socket.on("disconnect",function(){console.log("1100"),localStorage.removeItem("roomID"),sessionStorage.removeItem("active"),console.log("Disconnected!"),$inputMessage.prop("disabled",!0),$inputMessage.prop("placeholder","Connection Lost! Reconnecting..")}),socket.on("reconnect_failed",function(){console.log("1200"),console.log("Reconnection Failed!"),$inputMessage.prop("placeholder","No active connection. Please refresh page.")}),socket.on("reconnect",function(){console.log("1300"),setTimeout(function(){console.log("Reconnected!"),$inputMessage.prop("disabled",!1),$inputMessage.prop("placeholder","Type here..."),active&&id&&socket.emit("add user",{isNewUser:!1,roomID:id})},4e3)});