function sendMessage(e){$inputMessage=$("#"+e);var n=$inputMessage.parent(),s=n.children(".messages"),t=$inputMessage.val();if(t=cleanInput(t),t&&connected){$inputMessage.val("");var o=""+new Date;console.log("1200"),socket.emit("chat message",{roomID:e,msg:t,timestamp:o});var a=$('<span class="username"/>').text("You"),i=$('<span class="messageBody">').text(t),c=$('<span class="timestamp">').text(o.toLocaleString().substr(15,6)),r=$('<li class="message"/>').append(a,i,c);s.append(r),s[0].scrollTop=s[0].scrollHeight}}function isTyping(e){var n=e.target.id;13!==e.which&&void 0!==e.which?typing===!1&&$("#"+n).is(":focus")?(typing=!0,socket.emit("typing",{isTyping:!0,roomID:n,person:username})):(clearTimeout(timeout),timeout=setTimeout(function(){timeoutFunction(n)},2e3)):(sendMessage(n),clearTimeout(timeout),timeoutFunction(n))}function timeoutFunction(e){typing=!1,socket.emit("typing",{isTyping:!1,roomID:e,person:username})}function adminListListener(e){$("#"+e).on("click",function(e){var n=e.target.id;socket.emit("poke admin",n)})}function getChatArea(e){return"<div class='chatArea'><div class='chatHeader'></div><ul class='messages'></ul><div class='typing'></div><input class='inputMessage' id='"+e+"'' placeholder='Type here...'/></div>"}function setUsername(){username=cleanInput($usernameInput.val().trim()),username=username.toLowerCase(),password=$passwordInput.val(),username&&socket.emit("login",{admin:username,password:password})}function notifyAdmin(e,n){if("granted"!==Notification.permission)Notification.requestPermission();else{var s=new Notification(e,{icon:"",body:n});s.onclick=function(){$window.focus(),this.cancel()}}}function cleanInput(e){return $("<div/>").text(e).text()}var $window=$(window),$newUser=$("#windowSound")[0],$newChat=$("#chatSound")[0],$pokeAdmin=$("#pokeSound")[0],$usernameInput=$(".usernameInput"),$passwordInput=$(".passwordInput"),$loginPage=$(".login.page"),$errorPage=$(".error.page"),$chatPage=$(".chat.page"),$userList=$(".adminList"),$inputMessage,$messages,username,authenticated=!1,connected=!1,typing=!1,timeout=void 0,socket=io({transports:["websocket"]});$newUser.loop=!0,$usernameInput.focus(),Notification.requestPermission(),socket.on("login",function(e){$userList.empty(),authenticated=e.login,authenticated?($loginPage.fadeOut(),$chatPage.show(),console.log("100"),socket.emit("add admin",{admin:username,isAdmin:!0}),$userList.append("<li id="+username+">"+username+"</li>"),connected=!0):(alert(e.err),$usernameInput.val(""),$passwordInput.val(""),username=null,$usernameInput.focus())}),socket.on("chat message",function(e){console.log("200"),$inputMessage=$("#"+e.roomID);var n=$inputMessage.parent(),s=n.children(".messages");if(e.isAdmin)var t=$('<span class="username"/>').text("CronJ");else var t=$('<span class="username"/>').text("Client");var o=$('<span class="messageBody">').text(e.msg),a=$('<span class="timestamp">').text(e.timestamp.toLocaleString().substr(15,6)),i=$('<li class="message"/>').append(t,o,a);s.append(i),s[0].scrollTop=s[0].scrollHeight,$newChat.play()}),socket.on("admin added",function(e){console.log("300"),$userList.append("<li id="+e+">"+e+"</li>"),adminListListener(e)}),socket.on("admin removed",function(e){console.log("500"),$("#"+e).remove()}),socket.on("New Client",function(e){console.log("400"),$(".container").append(getChatArea(e.roomID)),$inputMessage=$("#"+e.roomID);var n=$inputMessage.parent(),s=n.children(".messages"),t=n.children(".chatHeader"),o=e.history.length;t.append(e.details[0]+" , "+e.details[1]+" , "+e.details[2]);for(var a,i=o-1;i>=0;i--){a=e.history[i].who?"You":"Client";var c=$('<span class="username"/>').text(a),r=$('<span class="messageBody">').text(e.history[i].what),l=$('<span class="timestamp">').text(e.history[i].when.toLocaleString().substr(15,6)),u=$('<li class="message"/>').append(c,r,l);s.append(u),s[0].scrollTop=s[0].scrollHeight}e.justJoined||($newUser.play(),notifyAdmin("New Client","Hey there!"+e.details[0]+" needs help!"),n.css("border","2px solid red"),$inputMessage=$("#"+e.roomID),$inputMessage.on("focus",function(){$newUser.pause(),n.css("border","1px solid black"),$inputMessage.off("focus"),socket.emit("client ack",{})})),$inputMessage.on("keypress",function(e){isTyping(e)})}),socket.on("typing",function(e){console.log("600"),$inputMessage=$("#"+e.roomID);var n=$inputMessage.parent(),s=n.children(".typing");e.isTyping?s.append("<small>"+e.person+" is typing...<small>"):s.text("")}),socket.on("client ack",function(){console.log("700"),$newUser.pause()}),socket.on("User Disconnected",function(e){console.log("800"),$newUser.pause(),$inputMessage=$("#"+e),$inputMessage.off();var n=$inputMessage.parent();n.remove()}),socket.on("poke admin",function(){$pokeAdmin.play()}),socket.on("reconnect",function(){console.log("900"),console.log("Reconnected!"),$userList.empty(),$(".container").empty(),$errorPage.fadeOut(),$userList.append("<li id="+username+">"+username+"</li>"),authenticated&&socket.emit("add admin",{admin:username,isAdmin:!0})}),socket.on("disconnect",function(){console.log("1000"),console.log("Disconnected!"),$errorPage.show()}),socket.on("reconnect_failed",function(){console.log("1100"),console.log("Reconnection Failed!");var e=$errorPage.children(".title");e.text("Reconection Failed. Please refresh your page. "),$window.alert("Disconnected from chat.")}),$passwordInput.keypress(function(e){13===e.which&&setUsername()});