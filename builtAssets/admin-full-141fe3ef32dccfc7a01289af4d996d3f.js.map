)]}'
{"version":3,"sources":["public\\js\\admin-full.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sourcesContent":["/* eslint-disable new-cap, max-len, no-var, key-spacing, quotes */\n\n// To-do\n\n// Add scroll to load more messages for Admins\n\n\n\n// Initialize variables\r\nvar $window = $(window);\r\nvar $newUser = $('#windowSound')[0];\r\nvar $newChat = $('#chatSound')[0];\r\nvar $pokeAdmin = $('#pokeSound')[0];\r\nvar $usernameInput = $('.usernameInput'); // Input for username\r\nvar $passwordInput = $('.passwordInput'); // Input for password\r\nvar $loginPage = $('.login.page'); // The login page\r\nvar $errorPage = $('.error.page'); // The error page\r\nvar $chatPage = $('.chat.page'); // The chat page\r\nvar $userList = $('.adminList'); // List of online admins\r\nvar $inputMessage; // Input message input box\r\nvar $messages; // Messages area\r\n\r\nvar username;\t// Store admin username\r\nvar authenticated = false; // Boolean to check if admin is authenticated\r\nvar connected = false;\r\nvar typing = false; // Boolean to check if admin is typing\r\nvar timeout = undefined; // Timeout to monitor typing\r\nvar socket = io({transports: ['websocket']}); // io socket\r\n$newUser.loop = true;\r\n$usernameInput.focus();\r\nNotification.requestPermission();\r\n\r\nvar totalChats = 0; // Used to rotate colors for new chats\r\nvar colorClasses = ['paletton-blue', 'paletton-purple', 'paletton-green', 'paletton-orange'];\r\n\r\nconsole.log('from admin js', _admin);\r\nusername = _admin.username;\r\n//username = \"ADMIN\";\r\n\r\n// ask for Login authentication to server\r\nconsole.log(username);\r\nsetUsername(username);\r\n\r\nsocket.on('login', function(data) {\r\n\t$userList.empty();\r\n\tauthenticated = data.login;\r\n\tif (authenticated) {\r\n\t\t$loginPage.fadeOut();\r\n\t\t$chatPage.show();\r\n\t\tconsole.log('100');\r\n\t\tsocket.emit('add admin', {\r\n\t\t\tadmin: username,\r\n\t\t\tisAdmin: true\r\n\t\t});\r\n\t\t$userList.append('<li id=' + username + '>' + username + '</li>');\r\n\t\tconnected = true;\r\n\t} else {\r\n\t\talert(data.err);\r\n\t\t$usernameInput.val('');\r\n\t\t$passwordInput.val('');\r\n\t\tusername = null;\r\n\t\t$usernameInput.focus();\r\n\t}\r\n});\r\n\r\n/*socket.on('chat message', function(data) {\r\n\tconsole.log('200');\r\n\t$inputMessage = $('#' + data.roomID);\r\n\tvar $parent = $inputMessage.parent();\r\n\tvar $messages = $parent.children(\".messages\");\r\n\tif (data.isAdmin)\r\n\t\tvar $usernameDiv = $('<span class=\"username\"/>').text(\"CronJ\");\r\n\telse\r\n\t\tvar $usernameDiv = $('<span class=\"username\"/>').text(\"Client\");\r\n\r\n\tvar $messageBodyDiv = $('<span class=\"messageBody\">').text(data.msg);\r\n\tvar $timestampDiv = $('<span class=\"timestamp\">').text((data.timestamp).toLocaleString().substr(15, 6));\r\n\tvar $messageDiv = $('<li class=\"message\"/>').append($usernameDiv, $messageBodyDiv, $timestampDiv);\r\n\t$messages.append($messageDiv);\r\n\t$messages[0].scrollTop = $messages[0].scrollHeight;\r\n\t$newChat.play();\r\n});*/\r\n\r\nsocket.on('chat message', function(data) {\r\n\tconsole.log('200');\r\n\t$inputMessage = $('#' + data.roomID);\r\n\tlet $chatContainer = $('#chat-' + data.roomID);\r\n\tlet $messageContainer = $chatContainer.find('.chat-messages');\r\n\r\n\tlet message = '<div class=\"message ' + (data.isAdmin ? 'message-sender' : 'message-receiver') + '\">' +\r\n        '<div class=\"message-text\">' + data.msg + '</div>' +\r\n    '</div>';\r\n\r\n\t//var $timestampDiv = $('<span class=\"timestamp\">').text((data.timestamp).toLocaleString().substr(15, 6));\r\n\t//var $messageDiv = $('<li class=\"message\"/>').append($usernameDiv, $messageBodyDiv, $timestampDiv);\r\n\r\n\tconsole.log($messageContainer);\r\n\r\n\t//TODO: If hidden, add 1 to the notification and blink\r\n\r\n\t$messageContainer.append(message);\r\n\t$messageContainer.scrollTop = $messageContainer.scrollHeight;\r\n\t$newChat.play();\r\n});\r\n\r\nsocket.on('admin added', function(username) {\r\n\tconsole.log('300');\r\n\t$userList.append('<li id=' + username + '>' + username + '</li>');\r\n\tadminListListener(username);\r\n});\r\n\r\nsocket.on('admin removed', function(username) {\r\n\tconsole.log('500');\r\n\t$('#' + username).remove();\r\n});\r\n\r\n/*socket.on('New Client', function(data) {\r\n\tconsole.log('400');\r\n\t$('.container').append(getChatArea(data.roomID));\r\n\t$inputMessage = $('#' + data.roomID);\r\n\tvar $parent = $inputMessage.parent();\r\n\tvar $messages = $parent.children(\".messages\");\r\n\tvar $chatHeader = $parent.children(\".chatHeader\");\r\n\tvar len = data.history.length;\r\n\t$chatHeader.append(data.details[0] + \" , \" + data.details[1] + \" , \" + data.details[2]);\r\n\tvar sender;\r\n\tfor (var i = len - 1; i >= 0; i--) {\r\n\t\tif (data[\"history\"][i][\"who\"])\r\n\t\t\tsender = \"You\"\r\n\t\telse\r\n\t\t\tsender = \"Client\"\r\n\t\tvar $usernameDiv = $('<span class=\"username\"/>').text(sender);\r\n\t\tvar $messageBodyDiv = $('<span class=\"messageBody\">').text(data[\"history\"][i][\"what\"]);\r\n\t\tvar $timestampDiv = $('<span class=\"timestamp\">').text((data[\"history\"][i][\"when\"]).toLocaleString().substr(15, 6));\r\n\t\tvar $messageDiv = $('<li class=\"message\"/>').append($usernameDiv, $messageBodyDiv, $timestampDiv);\r\n\t\t$messages.append($messageDiv);\r\n\t\t$messages[0].scrollTop = $messages[0].scrollHeight;\r\n\t}\r\n\tif (!data.justJoined) {\r\n\t\t$newUser.play();\r\n\t\tnotifyAdmin(\"New Client\", \"Hey there!\" + data.details[0] + \" needs help!\");\r\n\t\t$parent.css('border', '2px solid red');\r\n\t\t$inputMessage = $('#' + data.roomID);\r\n\t\t$inputMessage.on(\"focus\", function() {\r\n\t\t\t$newUser.pause();\r\n\t\t\t$parent.css('border', '1px solid black');\r\n\t\t\t$inputMessage.off('focus');\r\n\t\t\tsocket.emit('client ack', {});\r\n\t\t});\r\n\t}\r\n\t$inputMessage.on('keypress', function(e) {\r\n\t\tisTyping(e);\r\n\t});\r\n});*/\r\n\r\nsocket.on('New Client', function(data) {\r\n\tconsole.log(data);\r\n\tconsole.log('400');\r\n\t$('.chat-area').append(newChatContainer(data.roomID, data.details[0], \"Company\"));\r\n\t$('#sidebar').append(newSidebarChat(data.roomID, data.details[0], \"Company\"));\r\n\t$inputMessage = $('#' + data.roomID);\r\n\t$('#chat-' + data.roomID).find('.chat-messages').append(newTimestamp('Chat Start'))\r\n\r\n\t//TODO: Load history, check if new\r\n\t//TODO: Increment sidebar message count and flash\r\n\r\n\t$inputMessage.on('keypress', function(e) {\r\n\t\tisTyping(e);\r\n\t});\r\n});\r\n\r\nsocket.on('typing', function(data) {\r\n\tconsole.log('600');\r\n\t$inputMessage = $('#' + data.roomID);\r\n\tvar $parent = $inputMessage.parent();\r\n\tvar $typing = $parent.children(\".typing\");\r\n\tif (data.isTyping)\r\n\t\t$typing.append(\"<small>\" + data.person + \" is typing...<small>\");\r\n\telse\r\n\t\t$typing.text('');\r\n});\r\n\r\nsocket.on('client ack', function() {\r\n\tconsole.log('700');\r\n\t$newUser.pause();\r\n});\r\n\r\nsocket.on('User Disconnected', function(roomID) {\r\n\tconsole.log('800');\r\n\t$newUser.pause();\r\n\t$inputMessage = $('#' + roomID);\r\n\t$inputMessage.off();\r\n\tvar $parent = $inputMessage.parent();\r\n\t$parent.remove();\r\n});\r\n\r\nsocket.on('poke admin', function() {\r\n\r\n\t$pokeAdmin.play();\r\n});\r\n\r\nsocket.on('reconnect', function() {\r\n\tconsole.log('900');\r\n\tconsole.log(\"Reconnected!\");\r\n\t$userList.empty();\r\n\t$('.container').empty();\r\n\t$errorPage.fadeOut();\r\n\t$userList.append('<li id=' + username + '>' + username + '</li>');\r\n\tif (authenticated)\r\n\t\tsocket.emit('add admin', {\r\n\t\t\tadmin: username,\r\n\t\t\tisAdmin: true,\r\n\t\t});\r\n});\r\n\r\nsocket.on('disconnect', function() {\r\n\tconsole.log('1000');\r\n\tconsole.log(\"Disconnected!\");\r\n\t$errorPage.show();\r\n});\r\n\r\nsocket.on('reconnect_failed', function() {\r\n\tconsole.log('1100');\r\n\tconsole.log(\"Reconnection Failed!\");\r\n\tvar $errorMsg = $errorPage.children(\".title\");\r\n\t$errorMsg.text(\"Reconection Failed. Please refresh your page. \");\r\n\t$window.alert(\"Disconnected from chat.\");\r\n});\r\n\r\n// $passwordInput.keypress(function(event) {\r\n// \tif (event.which === 13)\r\n// \t\tsetUsername();\r\n// });\r\n\r\n/**\r\n * [sendMessage description]\r\n * @method  sendMessage\r\n * @param   {[type]}    id [description]\r\n * This is a function\r\n * @author Somenath Ghosh\r\n * @version [version]\r\n * @date    2017-06-12\r\n */\r\nfunction sendMessage(id) {\r\n\t$inputMessage = $('#' + id);\r\n\tlet $chatContainer = $('#chat-' + id);\r\n\tlet $messageContainer = $chatContainer.find('.chat-messages');\r\n\tlet message = $inputMessage.val();\r\n\t// Prevent markup from being injected into the message\r\n\tmessage = cleanInput(message);\r\n\t// if there is a non-empty message and a socket connection\r\n\tif (message && connected) {\r\n\t\t$inputMessage.val('');\r\n\t\t// tell server to execute 'new message' and send along one parameter\r\n\t\tvar time = (\"\" + new Date());\r\n\t\tconsole.log('1200');\r\n\t\tsocket.emit('chat message', {\r\n\t\t\troomID: id,\r\n\t\t\tmsg: message,\r\n\t\t\ttimestamp: time,\r\n\t\t});\r\n\t\t\r\n\t\tlet newMessage = '<div class=\"message message-sender\">' +\r\n\t        '<div class=\"message-text\">' + message + '</div>' +\r\n\t    '</div>';\r\n\r\n\t\t//var $timestampDiv = $('<span class=\"timestamp\">').text((data.timestamp).toLocaleString().substr(15, 6));\r\n\t\t//var $messageDiv = $('<li class=\"message\"/>').append($usernameDiv, $messageBodyDiv, $timestampDiv);\r\n\r\n\t\tconsole.log($messageContainer);\r\n\r\n\t\t$messageContainer.append(newMessage);\r\n\t\t$messageContainer.scrollTop = $messageContainer.scrollHeight;\r\n\t}\r\n}\r\n\r\n/**\r\n * [isTyping description]\r\n * @method  isTyping\r\n * @param   {[type]}   event [description]\r\n * This is a function\r\n * @author Somenath Ghosh\r\n * @version [version]\r\n * @date    2017-06-12\r\n */\r\nfunction isTyping(event) {\r\n\tvar id = event.target.id;\r\n\tif (event.which !== 13 && event.which !== undefined) {\r\n\t\tif (typing === false && $('#' + id).is(\":focus\")) {\r\n\t\t\ttyping = true;\r\n\t\t\tsocket.emit(\"typing\", {\r\n\t\t\t\tisTyping: true,\r\n\t\t\t\troomID: id,\r\n\t\t\t\tperson: username,\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tclearTimeout(timeout);\r\n\t\t\ttimeout = setTimeout(function() {\r\n\t\t\t\ttimeoutFunction(id);\r\n\t\t\t}, 2000);\r\n\t\t}\r\n\t} else {\r\n\t\tsendMessage(id);\r\n\t\tclearTimeout(timeout);\r\n\t\ttimeoutFunction(id);\r\n\t}\r\n}\r\n\r\n/**\r\n * [timeoutFunction description]\r\n * @method  timeoutFunction\r\n * @param   {[type]}        id [description]\r\n * This is a function\r\n * @author Somenath Ghosh\r\n * @version [version]\r\n * @date    2017-06-12\r\n */\r\nfunction timeoutFunction(id) {\r\n\ttyping = false;\r\n\tsocket.emit(\"typing\", {\r\n\t\tisTyping: false,\r\n\t\troomID: id,\r\n\t\tperson: username,\r\n\t});\r\n}\r\n\r\n/**\r\n * [adminListListener description]\r\n * @method  adminListListener\r\n * @param   {[type]}          target [description]\r\n * This is a function\r\n * @author Somenath Ghosh\r\n * @version [version]\r\n * @date    2017-06-12\r\n */\r\nfunction adminListListener(target) {\r\n\t$('#' + target).on('click', function(event) {\r\n\t\tvar pokeAdmin = event.target.id;\r\n\t\tsocket.emit('poke admin', pokeAdmin);\r\n\t});\r\n}\r\n\r\n/**\r\n * [getChatArea description]\r\n * @method  getChatArea\r\n * @param   {[type]}    id [description]\r\n * @return  {[type]}       [description]\r\n * This is a function\r\n * @author Somenath Ghosh\r\n * @version [version]\r\n * @date    2017-06-12\r\n */\r\nfunction getChatArea(id) {\r\n\treturn (\"<div class='chatArea'><div class='chatHeader'></div><ul class='messages'>\" +\r\n\t\t\"</ul><div class='typing'></div><input class='inputMessage' id='\" + id + \"'' placeholder='Type here...'/></div>\");\r\n}\r\n\r\n/**\r\n * [setUsername description]\r\n * @method  setUsername\r\n * @param   {[type]}    _username [description]\r\n * This is a function\r\n * @author Somenath Ghosh\r\n * @version [version]\r\n * @date    2017-06-12\r\n */\r\nfunction setUsername(_username) {\r\n\t// username = cleanInput($usernameInput.val().trim());\r\n\tusername = _username;\r\n\tpassword = 'password';\r\n\tusername = username.toLowerCase();\r\n\t// password = $passwordInput.val();\r\n\tif (username) {\r\n\t\t// If the username is valid\r\n\t\tsocket.emit('login', {\r\n\t\t\tadmin: username,\r\n\t\t\tpassword: password,\r\n\t\t});\r\n\t}\r\n}\r\n\r\n/**\r\n * [notifyAdmin description]\r\n * @method  notifyAdmin\r\n * @param   {[type]}    title [description]\r\n * @param   {[type]}    body  [description]\r\n * This is a function\r\n * @author Somenath Ghosh\r\n * @version [version]\r\n * @date    2017-06-12\r\n */\r\nfunction notifyAdmin(title, body) {\r\n\tif (Notification.permission !== \"granted\")\r\n\t\tNotification.requestPermission();\r\n\telse {\r\n\t\tvar notification = new Notification(title, {\r\n\t\t\ticon: '',\r\n\t\t\tbody: body,\r\n\t\t});\r\n\t\tnotification.onclick = function() {\r\n\t\t\t$window.focus();\r\n\t\t\tthis.cancel();\r\n\t\t};\r\n\t}\r\n}\r\n\r\n// Prevents input from having injected markup\r\n/**\r\n * [cleanInput description]\r\n * @method  cleanInput\r\n * @param   {[type]}   input [description]\r\n * @return  {[type]}         [description]\r\n * This is a function\r\n * @author Somenath Ghosh\r\n * @version [version]\r\n * @date    2017-06-12\r\n */\r\nfunction cleanInput(input) {\r\n\treturn $('<div/>').text(input).text();\r\n}\r\n\r\n\r\n// Full additions\r\n\r\nfunction newChatContainer(id, username, company) {\r\n\t// TODO: Rotate color class\r\n\tlet chatContainer = '';\r\n\r\n\tchatContainer += '<div class=\"chat-container\" id=\"chat-' + id + '\">' +\r\n\t\t'<div class=\"main-chat-header paletton-blue\">' +\r\n\t\t\t'<button type=\"button\" class=\"close\" aria-hidden=\"true\">×</button>' +\r\n\t\t\t'<div>' + username + '</div>' +\r\n\t\t\t'<div>' + company + '</div>' +\r\n\t\t'</div>' +\r\n\t\t'<div class=\"chat-messages\"></div>' +\r\n\t\t'<div class=\"chat-input\">' +\r\n            '<div class=\"row\">' +\r\n                '<div class=\"col-xs-9 form-group\">' +\r\n                    '<input type=\"text\" class=\"form-control\" id=\"' + id +'\" placeholder=\"Type Message\">' +\r\n                '</div>' +\r\n                '<div class=\"col-xs-3 form-group\">' +\r\n                    '<button type=\"button\" class=\"btn btn-primary form-control\">Send</button>' +\r\n                '</div>' +\r\n            '</div>' +\r\n        '</div>' +\r\n\t'</div>';\r\n\r\n\treturn chatContainer;\r\n}\r\n\r\nfunction newSidebarChat(id, username, company) {\r\n\t// TODO: Rotate color class\r\n\tlet chatContainer = '';\r\n\r\n\tchatContainer += '<div class=\"sidebar-chat paletton-blue\" id=\"sidebar-chat-' + id +'\" onclick=\"showChat(\\'' + id + '\\')\">' +\r\n        '<div>' + username + '</div>' +\r\n        '<div>' + username + '</div>' +\r\n        '<span class=\"sidebar-chat-notification\">0</span>' +\r\n    '</div>';\r\n\r\n\treturn chatContainer;\r\n}\r\n\r\nfunction showChat(id) {\r\n\t$('.chat-container').addClass('hidden');\r\n\t$('#chat-' + id).removeClass('hidden');\r\n}\r\n\r\nfunction newTimestamp(description) {\r\n\tlet timestamp = '';\r\n\tlet date = new Date();\r\n\tlet currentTime = date.getHours() + ':' + date.getMinutes();\r\n\r\n\ttimestamp += '<div class=\"time-message\">' +\r\n        '<div class=\"mid-horizontal-line\"></div>' +\r\n        '<div class=\"time-text\">' +\r\n            '<div>' + description +'</div>' +\r\n            '<div>' + currentTime +'</div>' +\r\n        '</div>' +\r\n    '</div>';\r\n\r\n\treturn timestamp;\r\n}\n;\n"],"sourceRoot":"/"}