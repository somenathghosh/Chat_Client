)]}'
{"version":3,"sources":["public\\js\\client.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sourcesContent":["// Initialize variables\r\nvar $window = $(window);\r\nvar $messages = $('.messages'); //Message area\r\nvar $inputMessage = $('.inputMessage');  //Text area to input msg\r\nvar $nameInput = $('.nameInput') //Name input\r\nvar $phoneInput = $('.phoneInput') //Phone number input\r\nvar $emailInput = $('.emailInput') //Email input\r\nvar $form = $('.formArea'); // Details form\r\nvar $widgetBox = $('.contentArea'); //Widget box\r\nvar $Input = $('.inputFields'); //Input fields in form\r\nvar $chatBox = $('.chatArea'); //Chat page after filling form\r\nvar $Typing = $(\".typing\") //Typing notification\r\nvar $newMsg = $('.msg_push_new'); //Dummy to push new msgs\r\nvar $oldMsg = $('.msg_push_old'); //Dummy to push msg history\r\n\r\nvar socket = io('/',{transports: ['websocket']}); //io socket\r\nvar typing = false; //Boolean to check if user is typing\r\nvar timeout = undefined; //Timeout to monitor typing\r\nvar id = localStorage.getItem(\"roomID\"); //Room ID in sessionStorage\r\nvar active = sessionStorage.getItem('active'); //Check if chat has been opened.\r\n\r\nif (active && id) {\r\n\t$form.hide();\r\n\t$chatBox.show();\r\n\tconsole.log('100');\r\n\tsocket.emit('add user', {\r\n\t\tisNewUser: false,\r\n\t\troomID: id\r\n\t});\r\n\t$widgetBox.show();\r\n}\r\n\r\n$('.msg_head').click(function() {\r\n\tconsole.log('200');\r\n\t$widgetBox.slideToggle('slow');\r\n\tif (id != null && !active) {\r\n\t\tsocket.emit('add user', {\r\n\t\t\tisNewUser: false,\r\n\t\t\troomID: id\r\n\t\t});\r\n\t\tconsole.log('new user');\r\n\t\t$form.hide();\r\n\t\t$chatBox.show();\r\n\t\t$inputMessage.focus();\r\n\t\tsessionStorage.setItem('active', true);\r\n\t\tactive = true;\r\n\t}\r\n});\r\n\r\n$Input.submit(function() {\r\n\t\r\n\tconsole.log('300');\r\n\tconsole.log('submit');\r\n\t$form.hide();\r\n\t$chatBox.show();\r\n\t$inputMessage.focus();\r\n\tsessionStorage.setItem('active', true);\r\n\tconsole.log('new user');\r\n\tsocket.emit('add user', {\r\n\t\tisNewUser: true,\r\n\t\tName: $nameInput.val().trim(),\r\n\t\tEmail: $emailInput.val().trim(),\r\n\t\tPhone: $phoneInput.val().trim()\r\n\t});\r\n\r\n\treturn false; //Needed in firefox so it doesn't reload the page\r\n});\r\n\r\n$inputMessage.keypress(function(event) {\r\n\tif (event.which !== 13) {\r\n\t\tif (typing === false && $inputMessage.is(\":focus\")) {\r\n\t\t\ttyping = true;\r\n\t\t\tconsole.log('400');\r\n\t\t\tsocket.emit(\"typing\", {\r\n\t\t\t\tisTyping: true,\r\n\t\t\t\troomID: id,\r\n\t\t\t\tperson: \"Client\"\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tclearTimeout(timeout);\r\n\t\t\ttimeout = setTimeout(timeoutFunction, 2000);\r\n\t\t}\r\n\t} else {\r\n\t\tsendMessage();\r\n\t\tclearTimeout(timeout);\r\n\t\ttimeoutFunction();\r\n\t}\r\n})\r\n\r\n$messages.on(\"scroll\", function() {\r\n\r\n\tif ($messages.scrollTop() == 0)\r\n\t\tsocket.emit(\"more messages\", {});\r\n})\r\n\r\nsocket.on('roomID', function(roomID) {\r\n\tconsole.log('500');\r\n\tid = roomID;\r\n\tlocalStorage.setItem(\"roomID\", roomID);\r\n});\r\n\r\nsocket.on('chat message', function(data) {\r\n\tconsole.log('600');\r\n\tvar sender;\r\n\tif (data.isAdmin)\r\n\t\tsender = \"msg_a\"\r\n\telse\r\n\t\tsender = \"msg_b\"\r\n\tvar $messageBodyDiv = $('<div class=\"' + sender + '\">' + data.msg + '<span class=\"timestamp\">' +\r\n\t\t((data.timestamp).toLocaleString().substr(15, 6)) + '</span></div>').insertBefore($newMsg);\r\n\t$messages[0].scrollTop = $messages[0].scrollHeight;\r\n});\r\n\r\nsocket.on('typing', function(data) {\r\n\tconsole.log('700');\r\n\tif (data.isTyping && data.person != 'Client')\r\n\t\t$Typing.append(\"Admin is typing...\");\r\n\telse\r\n\t\t$Typing.text('');\r\n});\r\n\r\nsocket.on('chat history', function(data) {\r\n\tconsole.log('800');\r\n\tvar len = data.history.length;\r\n\tfor (var i = len - 1; i >= 0; i--)\r\n\t\taddMessages(data.history[i], false);\r\n});\r\n\r\nsocket.on('more chat history', function(data) {\r\n\tconsole.log('900');\r\n\tvar len = data.history.length;\r\n\tfor (var i = 0; i < len; i++)\r\n\t\taddMessages(data.history[i], true);\r\n});\r\n\r\nsocket.on('log message', function(text) {\r\n\tconsole.log('1000');\r\n\tvar time = (\"\" + new Date());\r\n\tvar $messageDiv = $('<div class=\"msg_a\">' + text + '<span class=\"timestamp\">' +\r\n\t\t(time.toLocaleString().substr(15, 6)) + '</span></div>').insertBefore($newMsg);\r\n\t$messages[0].scrollTop = $messages[0].scrollHeight;\r\n});\r\n\r\nsocket.on('disconnect', function() {\r\n\tconsole.log('1100');\r\n\tlocalStorage.removeItem(\"roomID\");\r\n\tsessionStorage.removeItem('active');\r\n\tconsole.log(\"Disconnected!\");\r\n\t$inputMessage.prop('disabled', true);\r\n\t$inputMessage.prop('placeholder', \"Connection Lost! Reconnecting..\");\r\n\r\n});\r\n\r\nsocket.on('reconnect_failed', function() {\r\n\tconsole.log('1200');\r\n\tconsole.log(\"Reconnection Failed!\");\r\n\t$inputMessage.prop('placeholder', \"No active connection. Please refresh page.\");\r\n});\r\n\r\nsocket.on('reconnect', function() {\r\n\tconsole.log('1300');\r\n\tsetTimeout(function() {\r\n\t\tconsole.log(\"Reconnected!\");\r\n\t\t$inputMessage.prop('disabled', false);\r\n\t\t$inputMessage.prop('placeholder', \"Type here...\");\r\n\t\tif (active && id)\r\n\t\t\tsocket.emit('add user', {\r\n\t\t\t\tisNewUser: false,\r\n\t\t\t\troomID: id\r\n\t\t\t});\r\n\t}, 4000);\r\n});\r\n\r\nfunction timeoutFunction() {\r\n\ttyping = false;\r\n\tsocket.emit(\"typing\", {\r\n\t\tisTyping: false,\r\n\t\troomID: id,\r\n\t\tperson: \"Client\"\r\n\t});\r\n}\r\n\r\nfunction sendMessage() {\r\n\tvar message = $inputMessage.val();\r\n\t// Prevent markup from being injected into the message\r\n\tmessage = cleanInput(message);\r\n\t// if there is a non-empty message\r\n\tif (message) {\r\n\t\t$inputMessage.val('');\r\n\t\tvar time = (\"\" + new Date());\r\n\t\t// tell server to execute 'new message' and send along one parameter\r\n\t\t//\r\n\t\tconsole.log('1400');\r\n\t\tsocket.emit('chat message', {\r\n\t\t\troomID: \"null\",\r\n\t\t\tmsg: message,\r\n\t\t\ttimestamp: time\r\n\t\t});\r\n\t\tvar $messageBodyDiv = $('<div class=\"msg_b\">' + message + '<span class=\"timestamp\">' +\r\n\t\t\t(time.toLocaleString().substr(15, 6)) + '</span></div>').insertBefore($newMsg);\r\n\t\t$messages[0].scrollTop = $messages[0].scrollHeight;\r\n\t}\r\n}\r\n\r\nfunction addMessages(data, getMore) {\r\n\tvar sender;\r\n\tif (data[\"who\"])\r\n\t\tsender = \"msg_a\"\r\n\telse\r\n\t\tsender = \"msg_b\"\r\n\tvar $messageBodyDiv = $('<div class=\"' + sender + '\">' + data[\"what\"] + '<span class=\"timestamp\">' +\r\n\t\t(data[\"when\"]).toLocaleString().substr(15, 6) + '</span></div>');\r\n\tif (getMore) {\r\n\t\t$messageBodyDiv.insertAfter($oldMsg);\r\n\t\t$messages[0].scrollTop += $messageBodyDiv.outerHeight();\r\n\t} else {\r\n\t\t$messageBodyDiv.insertBefore($newMsg);\r\n\t\t$messages[0].scrollTop = $messages[0].scrollHeight;\r\n\t}\r\n}\r\n\r\n// Prevents input from having injected markup\r\nfunction cleanInput(input) {\r\n\treturn $('<div/>').text(input).text();\r\n}\n;\n"],"sourceRoot":"/"}